

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>plot_binary_ah_period.py &#8212; kuibit 1.4.0-dev2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bizstyle.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="plot_charge_phi1.py" href="plot_charge_phi1.html" />
    <link rel="prev" title="plot_ah_trajectories.py" href="plot_ah_trajectories.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plot_charge_phi1.html" title="plot_charge_phi1.py"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_ah_trajectories.html" title="plot_ah_trajectories.py"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">kuibit 1.4.0-dev2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">plot_binary_ah_period.py</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="plot-binary-ah-period-py">
<h1>plot_binary_ah_period.py<a class="headerlink" href="#plot-binary-ah-period-py" title="Permalink to this headline">Â¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">plot_binary_ah_period</span></code> plots the period on the equatorial plane estimated in
the following way. First, we compute the Newtonian angular velocity with the
cross product between the separation and its time derivative, and then we
compute the associated period.</p>
<p>This leads to a lot junk values, so the script contains an heuristics to improve
the plotting range, but it that does not work, you can manually choose the
bounds with <code class="docutils literal notranslate"><span class="pre">--ymin</span></code> and <code class="docutils literal notranslate"><span class="pre">--ymax</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># PYTHON_ARGCOMPLETE_OK</span>

<span class="c1"># Copyright (C) 2022 Gabriele Bozzola</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify it under</span>
<span class="c1"># the terms of the GNU General Public License as published by the Free Software</span>
<span class="c1"># Foundation; either version 3 of the License, or (at your option) any later</span>
<span class="c1"># version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="c1"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="c1"># FOR A PARTICULAR PURPOSE. See the GNU General Public License for more</span>
<span class="c1"># details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along with</span>
<span class="c1"># this program; if not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">kuibit</span> <span class="kn">import</span> <span class="n">argparse_helper</span> <span class="k">as</span> <span class="n">kah</span>
<span class="kn">from</span> <span class="nn">kuibit.hor_utils</span> <span class="kn">import</span> <span class="n">compute_angular_velocity_vector</span>
<span class="kn">from</span> <span class="nn">kuibit.simdir</span> <span class="kn">import</span> <span class="n">SimDir</span>
<span class="kn">from</span> <span class="nn">kuibit.visualize_matplotlib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_figname</span><span class="p">,</span>
    <span class="n">save_from_dir_filename_ext</span><span class="p">,</span>
    <span class="n">set_axis_limits_from_args</span><span class="p">,</span>
    <span class="n">setup_matplotlib</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="si">{</span><span class="n">kah</span><span class="o">.</span><span class="n">get_program_name</span><span class="p">()</span><span class="si">}</span><span class="s2"> plots the period as on the equatorial plane as computed</span>
<span class="s2">from Newtonian angular velocity of the equivalent Kepler problem. This</span>
<span class="s2">calculation typically has some very large numbers, this script does its best to</span>
<span class="s2">choose the bounds, but often you will need to manually specify --ymax and</span>
<span class="s2">--ymin.&quot;&quot;&quot;</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">kah</span><span class="o">.</span><span class="n">init_argparse</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
    <span class="n">kah</span><span class="o">.</span><span class="n">add_figure_to_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">add_limits</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--horizons&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Apparent horizons to plot&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">kah</span><span class="o">.</span><span class="n">get_args</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">setup_matplotlib</span><span class="p">(</span><span class="n">rc_par_file</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mpl_rc_file</span><span class="p">)</span>

    <span class="c1"># Parse arguments</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">figname</span> <span class="o">=</span> <span class="n">get_figname</span><span class="p">(</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ah_</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">horizons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">horizons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_period&quot;</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using figname </span><span class="si">{</span><span class="n">figname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">SimDir</span><span class="p">(</span>
        <span class="n">args</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span>
        <span class="n">ignore_symlinks</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">ignore_symlinks</span><span class="p">,</span>
        <span class="n">pickle_file</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">pickle_file</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prepared SimDir&quot;</span><span class="p">)</span>
        <span class="n">sim_hor</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">horizons</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Apparent horizons available: </span><span class="si">{</span><span class="n">sim_hor</span><span class="o">.</span><span class="n">available_apparent_horizons</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Check that the horizons are available</span>
        <span class="k">for</span> <span class="n">ah</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">horizons</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ah</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sim_hor</span><span class="o">.</span><span class="n">available_apparent_horizons</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Apparent horizons </span><span class="si">{</span><span class="n">ah</span><span class="si">}</span><span class="s2"> is not available&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading horizons and computing velocity&quot;</span><span class="p">)</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">sim_hor</span><span class="o">.</span><span class="n">get_apparent_horizon</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">horizons</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">sim_hor</span><span class="o">.</span><span class="n">get_apparent_horizon</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">horizons</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">Omega</span> <span class="o">=</span> <span class="n">compute_angular_velocity_vector</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting period&quot;</span><span class="p">)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">Omega</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">period</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median </span><span class="si">{</span><span class="n">median</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Set args.ymin/args.ymax if they are None</span>
        <span class="n">args</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ymin</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="n">args</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ymax</span> <span class="ow">or</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">median</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Omega_z&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Period&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
        <span class="n">set_axis_limits_from_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotted&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving&quot;</span><span class="p">)</span>
        <span class="n">save_from_dir_filename_ext</span><span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span>
            <span class="n">figname</span><span class="p">,</span>
            <span class="n">args</span><span class="o">.</span><span class="n">fig_extension</span><span class="p">,</span>
            <span class="n">tikz_clean_figure</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">tikz_clean_figure</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;DONE&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_ah_trajectories.html"
                        title="previous chapter">plot_ah_trajectories.py</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plot_charge_phi1.html"
                        title="next chapter">plot_charge_phi1.py</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plot_charge_phi1.html" title="plot_charge_phi1.py"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_ah_trajectories.html" title="plot_ah_trajectories.py"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">kuibit 1.4.0-dev2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">plot_binary_ah_period.py</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020-2022, Gabriele Bozzola.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>